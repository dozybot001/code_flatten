const CONFIG={ignoreDirs:[],ignoreExts:[],tokenWeights:{chinese:1.5,other:0.25}};
const BINARY_EXTS=new Set(['png','jpg','jpeg','gif','bmp','tiff','ico','svg','webp','avif','mp4','mp3','wav','mov','avi','mkv','flv','pdf','doc','docx','xls','xlsx','ppt','pptx','zip','tar','gz','7z','rar','exe','dll','so','dylib','class','jar','db','sqlite','sqlite3','ttf','otf','woff','woff2']);
const LANG_MAP={js:'javascript',jsx:'jsx',ts:'typescript',tsx:'tsx',html:'html',css:'css',scss:'scss',less:'less',json:'json',py:'python',java:'java',c:'c',cpp:'cpp',h:'cpp',cs:'csharp',go:'go',rs:'rust',php:'php',rb:'ruby',sh:'bash',yaml:'yaml',yml:'yaml',md:'markdown',sql:'sql',xml:'xml',vue:'vue',txt:'text',ini:'ini',toml:'toml',dockerfile:'dockerfile'};
const STATE={files:[],projectName:"Project",ignoreRules:[],lang:'zh'};
const UI={inputs:{},areas:{},stats:{},btns:{},modals:{}};
const I18N_RESOURCES={
zh:{labels:{appName:"AIchemy",github:"GitHub",blog:"åšå®¢",panelFiles:"é¡¹ç›®æ–‡ä»¶",statFiles:"æ–‡ä»¶æ•°",statTokens:"Token æ•°",panelPreview:"åˆå¹¶é¢„è§ˆ",panelPatch:"ç²˜è´´è¡¥ä¸",panelDiff:"å˜æ›´é¢„è§ˆ",statBaseline:"åŸºå‡†æ–‡ä»¶",panelRestore:"æ‰‹åŠ¨è¿˜åŸ",baselineName:"~",panelArchitect:"Prompt æ¶æ„å¸ˆ"},buttons:{import:"åŠ è½½é¡¹ç›®",copyTree:"å¤åˆ¶æ ‘",append:"è¿½åŠ ",selectAll:"å…¨é€‰",merge:"åˆå¹¶",clearWorkspace:"ğŸ—‘ï¸",copy:"å¤åˆ¶",download:"ä¸‹è½½",clear:"ğŸ—‘ï¸",previewPatch:"é¢„è§ˆå˜æ›´",uploadBaseline:"ä¸Šä¼ åŸºå‡†",applyPatch:"åº”ç”¨å˜æ›´",packDownload:"æ‰“åŒ…ä¸‹è½½",switchLang:"English",applyDownload:"åº”ç”¨ & ä¸‹è½½",applyCopy:"åº”ç”¨ & å¤åˆ¶"},placeholder:{tree:"ç­‰å¾…å¯¼å…¥é¡¹ç›®æ–‡ä»¶â€¦",merge:"åˆå¹¶åçš„æ–‡æœ¬â€¦",patch:"åœ¨æ­¤ç²˜è´´è¡¥ä¸ä»£ç â€¦",diff:"åº”ç”¨è¡¥ä¸åçš„å·®å¼‚å¯¹æ¯”â€¦",restore:"åœ¨æ­¤ç²˜è´´æ–‡æœ¬â€¦",architectInput:"è¾“å…¥ä½ çš„ç®€çŸ­æƒ³æ³•ï¼Œä¾‹å¦‚ï¼šæˆ‘è¦åšä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ..."},toast:{emptyContent:"å†…å®¹ä¸ºç©º",copySuccess:"å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",copyFail:"å¤åˆ¶å¤±è´¥",noMergeFiles:"æ²¡æœ‰å¯ä¾›åˆå¹¶çš„æ–‡ä»¶",mergeSuccess:c=>`å·²åˆå¹¶ ${c} ä¸ªæ–‡ä»¶`,restoreFail:"è¯·å…ˆåœ¨ä¸‹æ–¹ç²˜è´´å†…å®¹",restoreNoTag:"æœªæ‰¾åˆ°æ–‡ä»¶æ ‡è®°",restoreSuccess:c=>`å·²è§£æå¹¶æ‰“åŒ… ${c} ä¸ªæ–‡ä»¶`,patchEmpty:"è¡¥ä¸å†…å®¹ä¸ºç©º",patchInvalid:"æœªè¯†åˆ«åˆ°æœ‰æ•ˆçš„è¡¥ä¸å—",diffNoChange:"æ²¡æœ‰æœ‰æ•ˆçš„å˜æ›´å¯é¢„è§ˆ",diffSuccess:c=>`æˆåŠŸè§£æ ${c} å¤„å˜æ›´ï¼Œè¯·ç¡®è®¤ååº”ç”¨`,applyNoChange:"æ²¡æœ‰å¾…åº”ç”¨çš„å˜æ›´",applySuccess:c=>`âœ… å·²æ›´æ–° ${c} ä¸ªæ–‡ä»¶`,projectLoaded:(t,i)=>i>0?`å·²åŠ è½½ ${t} ä¸ªæ–‡ä»¶ï¼ˆå·²å¿½ç•¥ ${i} ä¸ªï¼‰`:`å·²åŠ è½½ ${t} ä¸ªæ–‡ä»¶`,projectCleared:"é¡¹ç›®å·²æ¸…ç©º",baselineLoaded:n=>`å·²åŠ è½½åŸºå‡†æ–‡ä»¶ï¼š${n}`,treeRestored:c=>`å·²æ¢å¤å…¨é€‰çŠ¶æ€ï¼ˆ${c} ä¸ªæ–‡ä»¶ï¼‰`,addedFiles:c=>`è¿½åŠ äº† ${c} ä¸ªæ–‡ä»¶`,gitIgnoreDetected:c=>`æ£€æµ‹å¹¶åº”ç”¨äº† ${c} ä¸ª .gitignore è§„åˆ™`,beforeUnload:"ç¡®å®šè¦ç¦»å¼€å—ï¼Ÿå½“å‰é¡¹ç›®å†…å®¹å°†ä¼šä¸¢å¤±ã€‚",binaryOmitted:"ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶å·²çœç•¥ï¼‰",fileTooLarge:"ï¼ˆæ–‡ä»¶è¿‡å¤§ï¼Œä»…éƒ¨åˆ†å¤„ç†ï¼‰"},templates:{diffNotFound:p=>`âŒ æœªæ‰¾åˆ°æ–‡ä»¶ï¼š${p}`,diffAmbiguous:p=>`âš ï¸ åŒ¹é…å­˜åœ¨æ­§ä¹‰ï¼š${p}`,diffAmbiguousDesc:(c,s)=>`<strong>æ­¤ä»£ç æ®µå‡ºç°äº† ${c} æ¬¡ã€‚</strong><br/>å·²åœæ­¢ä¿®æ”¹ã€‚<br/><br/><em style="opacity:0.6">å»ºè®®ï¼šè¯·æ‰©å±• Search Block ä¸Šä¸‹æ–‡ã€‚</em><hr style="border:0;border-top:1px dashed #555;margin:10px 0"/>ç›®æ ‡ä»£ç æ®µï¼š<br/><pre style="color:#ff9800;font-size:0.8em;">${s}</pre>`,diffMatchFail:p=>`âš ï¸ åŒ¹é…å¤±è´¥ï¼š${p}`,diffMatchFailDesc:s=>`<strong>æ— æ³•å®šä½ Search Blockã€‚</strong><br/>ç›®æ ‡ä»£ç æ®µï¼š<br/><pre style="text-align:left;opacity:0.7;max-height:100px;overflow:auto;">${s}</pre>`,labelBaseline:"ï¼ˆåŸºå‡†æ–‡ä»¶ï¼‰"},prompt:{header:`ä»¥ä¸‹æ˜¯é¡¹ç›®çš„ç›®å½•ç»“æ„ä¸æ–‡ä»¶å†…å®¹ã€‚è¯·åŸºäºæ­¤ä¸Šä¸‹æ–‡å›ç­”æˆ‘çš„é—®é¢˜ï¼š\n\n`},html:{diffEmptyState:`<div class="empty-hint">æ­¤å¤„å°†æ˜¾ç¤ºåº”ç”¨è¡¥ä¸åçš„å·®å¼‚å¯¹æ¯”â€¦</div>`,treeEmptyState:`<div class="empty-hint">æ­¤å¤„å°†æ˜¾ç¤ºé¡¹ç›®æ–‡ä»¶å†…å®¹â€¦</div>`,treeWaiting:`<div class="empty-hint">ç­‰å¾…å¯¼å…¥é¡¹ç›®æ–‡ä»¶â€¦</div>`}},
en:{labels:{appName:"AIchemy",github:"GitHub",blog:"Blog",panelFiles:"Files",statFiles:"Count",statTokens:"Tokens",panelPreview:"Preview",panelPatch:"Patch Source",panelDiff:"Diff View",statBaseline:"Baseline",panelRestore:"Restore",baselineName:"~",panelArchitect:"Prompt Architect"},buttons:{import:"Import",copyTree:"Copy Tree",append:"Add",selectAll:"Select All",merge:"Merge",clearWorkspace:"ğŸ—‘ï¸",copy:"Copy",download:"Download",clear:"ğŸ—‘ï¸",previewPatch:"Preview Diff",uploadBaseline:"Upload Base",applyPatch:"Apply",packDownload:"Pack & DL",switchLang:"ä¸­æ–‡",applyDownload:"Apply & DL",applyCopy:"Apply & Copy"},placeholder:{tree:"Waiting for files...",merge:"Merged content...",patch:"Paste patch here...",diff:"Diff result...",restore:"Paste text here...",architectInput:"Brief idea, e.g., Snake game..."},toast:{emptyContent:"Empty content",copySuccess:"Copied",copyFail:"Copy failed",noMergeFiles:"No files to merge",mergeSuccess:c=>`Merged ${c} files`,restoreFail:"Paste content first",restoreNoTag:"No file tags found",restoreSuccess:c=>`Packed ${c} files`,patchEmpty:"Patch empty",patchInvalid:"Invalid patch format",diffNoChange:"No changes",diffSuccess:c=>`Parsed ${c} changes`,applyNoChange:"No changes to apply",applySuccess:c=>`âœ… Updated ${c} files`,projectLoaded:(t,i)=>i>0?`Loaded ${t} files (${i} ignored)`:`Loaded ${t} files`,projectCleared:"Project cleared",baselineLoaded:n=>`Baseline: ${n}`,treeRestored:c=>`Restored ${c} files`,addedFiles:c=>`Added ${c} files`,gitIgnoreDetected:c=>`Applied ${c} .gitignore rules`,beforeUnload:"Leave? Changes will be lost.",binaryOmitted:"(Binary omitted)",fileTooLarge:"(File too large)"},templates:{diffNotFound:p=>`âŒ Not found: ${p}`,diffAmbiguous:p=>`âš ï¸ Ambiguous: ${p}`,diffAmbiguousDesc:(c,s)=>`<strong>Snippet appears ${c} times.</strong><br/>Aborted.<br/><br/><em style="opacity:0.6">Tip: Expand context in Search Block.</em><hr style="border:0;border-top:1px dashed #555;margin:10px 0"/>Target:<br/><pre style="color:#ff9800;font-size:0.8em;">${s}</pre>`,diffMatchFail:p=>`âš ï¸ Match failed: ${p}`,diffMatchFailDesc:s=>`<strong>Cannot locate Search Block.</strong><br/>Target:<br/><pre style="text-align:left;opacity:0.7;max-height:100px;overflow:auto;">${s}</pre>`,labelBaseline:"(Baseline)"},prompt:{header:`Here is the project structure and content. Please answer based on this context:\n\n`},html:{diffEmptyState:`<div class="empty-hint">Diff view...</div>`,treeEmptyState:`<div class="empty-hint">File content...</div>`,treeWaiting:`<div class="empty-hint">Waiting for files...</div>`}}
};
var UI_TEXT=I18N_RESOURCES.zh;
const MAGIC_TOKEN="\=== File:",ESCAPED_TOKEN="\\\=== File:";